---
import About from "../fragments/About.astro";
import Career from "../fragments/Career.astro";
import Contact from "../fragments/Contact.astro";
import Hero from "../fragments/Hero.astro";
import Projects from "../fragments/Projects.astro";
import Layout from "../layouts/Layout.astro";
---

<Layout>
  <Hero />
  <Projects id="projects_fragment" />
  <About />
  <Career />
  <Contact />
</Layout>

<script>
  const projects = document.getElementById(
    "projects_fragment"
  ) as HTMLDivElement;
  const hero = document.getElementById("hero_fragment") as HTMLDivElement;
  const gradient = document.getElementById(
    "gradientBackground"
  ) as HTMLDivElement;

  let projectsOffset = projects.scrollHeight;
  let heroOffset = hero.scrollHeight;
  let total = heroOffset + projectsOffset;
  let engageGradient = total - total / 8;

  function pourSecondColour() {
    const scroll = window.scrollY;

    if (scroll <= total) {
      if (scroll <= heroOffset) {
        const pourPercentage = Math.round((scroll / heroOffset) * 100);
        document.documentElement.style.setProperty(
          "--second-bg-color-percentage",
          `${pourPercentage}`
        );
      } else if (scroll >= engageGradient && scroll <= total) {
        const opacityNormalised =
          (scroll - engageGradient) / (total - engageGradient);
        gradient.style.opacity = `${opacityNormalised}`;
      }
    }
  }

  window.addEventListener("resize", () => {
    projectsOffset = projects.scrollHeight;
    pourSecondColour();
  });

  window.addEventListener("scroll", () => {
    pourSecondColour();
  });

  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          if (entry.target.id === "projects_fragment")
            gradient.style.opacity = "0";
          else if (entry.target.id === "hero_fragment")
            document.documentElement.style.setProperty(
              "--second-bg-color-percentage",
              "0"
            );
        }
      });
    },
    {
      rootMargin: "-100% 0px 0px 0px",
    }
  );

  observer.observe(hero);
  observer.observe(projects);
</script>
