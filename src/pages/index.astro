---
import About from "../fragments/About.astro";
import Career from "../fragments/Career.astro";
import Hero from "../fragments/Hero.astro";
import Projects from "../fragments/Projects.astro";
import Layout from "../layouts/Layout.astro";
---

<Layout>
  <Hero id="hero_fragment" />
  <Projects id="projects_fragment" />
  <About />
  <Career />
</Layout>

<script>
  const projects = document.getElementById(
    "projects_fragment"
  ) as HTMLDivElement;
  const hero = document.getElementById("hero_fragment") as HTMLDivElement;
  const gradient = document.getElementById(
    "gradientBackground"
  ) as HTMLImageElement;

  let projectsOffset = projects.scrollHeight;
  let heroOffset = hero.scrollHeight;
  let total = heroOffset + projectsOffset;
  let engageGradient = total - total / 8;

  function pourSecondColour() {
    const scroll = window.scrollY;

    if (scroll <= total) {
      if (scroll <= heroOffset) {
        const pourPercentage = Math.round((scroll / heroOffset) * 100);
        console.log(scroll, heroOffset, pourPercentage);
        document.documentElement.style.setProperty(
          "--second-bg-color-pour",
          `${pourPercentage}%`
        );
      } else if (scroll >= engageGradient && scroll <= total) {
        const opacityNormalised =
          (scroll - engageGradient) / (total - engageGradient);
        gradient.style.opacity = `${opacityNormalised}`;
      }
    }

    // if (window.scrollY < window.innerHeight) {
    //   const scrollPercentage = (window.scrollY * 100) / window.innerHeight;
    //   document.documentElement.style.setProperty(
    //     "--second-bg-color-pour",
    //     `${scrollPercentage}%`
    //   );
    // } else {
    //   const pastH = window.scrollY - projectsOffset;

    //   if (pastH < window.innerHeight && pastH > 0) {
    //     const scrollPercentage = 100 - (pastH * 100) / window.innerHeight;
    //     document.documentElement.style.setProperty(
    //       "--second-bg-color-pour",
    //       `${scrollPercentage}%`
    //     );
    //   }
    // }
  }

  window.addEventListener("resize", () => {
    projectsOffset = projects.scrollHeight;
    pourSecondColour();
  });

  window.addEventListener("scroll", () => {
    pourSecondColour();
  });

  // top - black
  // projects - victoria
  // rest - gradient
  // Scroll 100% of screen -> victoria
  // Scroll 90% of projects -> gradient
</script>
